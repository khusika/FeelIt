{{- $params := .Scratch.Get "params" -}}
{{- $offline := $params.offline -}}

<meta name="description" content="{{ $params.description | default .Site.Params.description }}">

{{- if ne $offline true -}}
    {{- $og := partial "opengraph.html" . -}}
    {{- $twitter := partial "twitter_cards.html" . -}}
    {{- $image := "" -}}
    {{- with .Params.featuredimage | default .Params.featuredImage -}}
        {{- $original := resources.Get . -}}
        {{- with $original }}
            {{- $processed := .Fit "800x450 Lanczos" -}}
            {{- $image = $processed.Permalink -}}
        {{- end -}}
    {{- else -}}
        {{- with .Resources.GetMatch "featured-image" -}}
            {{- $processed := .Fit "800x450 Lanczos" -}}
            {{- $image = $processed.Permalink -}}
        {{- else -}}
            {{- range .Params.resources -}}
                {{- if eq .name "featured-image" -}}
                    {{- $original := resources.Get .src -}}
                    {{- with $original }}
                        {{- $processed := .Fit "800x450 Lanczos" -}}
                        {{- $image = $processed.Permalink -}}
                    {{- end -}}
                {{- end -}}
            {{- end -}}
        {{- end -}}
    {{- end -}}
    {{- if $image }}
        {{- $og = replaceRE `<meta property="og:image" content="[^"]*">` (printf `<meta property="og:image" content="%s">` $image) $og -}}
        {{- $twitter = replaceRE `<meta name="twitter:image" content="[^"]*">` (printf `<meta name="twitter:image" content="%s">` $image) $twitter -}}
    {{- end -}}
    {{- $og | safeHTML -}}
    {{- $twitter | safeHTML -}}
{{- end -}}

<meta name="application-name" content="{{ .Site.Params.app.title | default .Site.Title }}">
<meta name="apple-mobile-web-app-title" content="{{ .Site.Params.app.title | default .Site.Title }}">

{{- with .Site.Params.app.themeColor -}}
    <meta name="theme-color" content="{{ . }}">
{{- end -}}

{{- with .Site.Params.app.tileColor -}}
    <meta name="msapplication-TileColor" content="{{ . }}">
{{- end -}}
